# Maintainer: thesting <fxcw_vacilon@slmail.me>
# Changelog: https://github.com/aws/aws-cli/blob/v2/CHANGELOG.rst
pkgname=aws-cli
pkgver=2.4.7
pkgrel=1
pkgdesc="The latest version of the AWS CLI."
arch=('x86_64')
license=('Apache-2.0')
depends=()
makedepends=('zip')
url="https://github.com/aws/aws-cli"
_filename="awscli-exe-linux-${arch}-${pkgver}.zip"

source=(
  https://awscli.amazonaws.com/awscli-exe-linux-${arch}-${pkgver}.zip
)
sha512sums=(
  d86d0db165931cc2106cdc091a652e6afa59703f3dec14101182ecb9ac137952e52de292d12c947bc07b704996d9f88d0ecaca17200a74f77f6fe3e4d059e06d
)


package() {
  $srcdir/aws/install -i "$pkgdir/usr/share/aws-cli" -b "$pkgdir/usr/bin" >/dev/null

  # Install binary symlinks
  BIN_DIR="/usr/share/aws-cli/v2/$pkgver/bin"
  for i in $pkgdir/$BIN_DIR/*; do
    ln -sf "$BIN_DIR/$(basename $i)" "$pkgdir/usr/bin/"
  done
  
  # Fix symlink for current version
  rm "$pkgdir/usr/share/aws-cli/v2/current"
  ln -s "/usr/share/aws-cli/v2/$pkgver" "$pkgdir/usr/share/aws-cli/v2/current"
}
