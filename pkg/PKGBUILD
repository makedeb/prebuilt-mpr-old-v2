# Maintainer: only_vip <onlyme_vip@protonmail.com>
pkgname=rl-custom-function-git
_pkgname=rl_custom_function
__pkgname=rl-custom-function
pkgver=1.28f437d
pkgrel=2
pkgdesc="Enable to inject custom functions into any readline applications"
arch=('i686' 'amd64')
url="https://github.com/lincheney/rl_custom_function"
license=('GPL3')
buster_depends=('libreadline7' 'libreadline5')
focal_depends=('libreadline8')
makedepends=('rustc' 'cargo')
provides=("${__pkgname}")
conflicts=("${__pkgname}")
# replaces=("${_pkgname}")
source=("${_pkgname}::git+https://github.com/lincheney/${_pkgname}.git")
sha256sums=('SKIP')

pkgver() {
  cd "$srcdir/${_pkgname}"
  printf "%s.%s" "$(git rev-list --count HEAD)" "$(git rev-parse --short HEAD)"
}

build() {
  cd "$srcdir/${_pkgname}"
  cargo build --release
}

check() {
  cd "$srcdir/${_pkgname}"
  cargo test --release
}

package() {
  cd "$srcdir/${_pkgname}"
  install -D -m755 target/release/librl_custom_function.so $pkgdir/usr/lib/librl_custom_function.so
  install -D -m644 README.md $pkgdir/usr/share/doc/${_pkgname}/README.md
}
